"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isLimitRateHit = void 0;
const validateLimitRateParams_1 = require("../validateLimitRateParams/validateLimitRateParams");
const getLeftTime = (id, throttle, storage) => {
    const lastTime = Number(storage.get(id) || 0);
    return throttle - Date.now() + lastTime;
};
const removeRecord = (id, leftTime, storage) => {
    setTimeout(() => {
        storage.remove(id);
    }, leftTime);
};
const isLimitRateHit = (defaultID, options, storage) => {
    if (!options.throttle || !storage) {
        return false;
    }
    (0, validateLimitRateParams_1.validateLimitRateParams)(options.throttle, options.id);
    const id = options.id || defaultID;
    const leftTime = getLeftTime(id, options.throttle, storage);
    if (leftTime > 0) {
        removeRecord(id, leftTime, storage);
        return true;
    }
    storage.set(id, Date.now().toString());
    removeRecord(id, options.throttle, storage);
    return false;
};
exports.isLimitRateHit = isLimitRateHit;
